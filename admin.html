<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JB Essential Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f3f3f3; }
    .sidebar { width: 200px; background: #232f3e; height: 100vh; position: fixed; color: white; padding-top: 20px; }
    .sidebar a { color: white; display: block; padding: 10px 20px; text-decoration: none; }
    .sidebar a:hover { background: #febd69; color: black; }
    .content { margin-left: 200px; padding: 20px; }
    .card { margin-bottom: 20px; }
    #login-section {
      width: 100%; height: 100vh; display: flex; align-items: center; justify-content: center; background-color: #f3f3f3;
    }
    #admin-panel { display: none; }
  </style>
</head>
<body>

  <div id="login-section">
    <div class="card p-4" style="max-width: 400px; width: 100%;">
      <h4 class="mb-3">Admin Login</h4>
      <input id="admin-username" class="form-control mb-2" type="text" placeholder="Username">
      <input id="admin-password" class="form-control mb-3" type="password" placeholder="Password">
      <button class="btn btn-primary w-100" id="login-button">Login</button>
      <p class="text-danger mt-2 d-none" id="login-error">Invalid credentials</p>
    </div>
  </div>

  <div id="admin-panel">
    <div class="sidebar">
      <h4 class="text-center">Admin Panel</h4>
      <a href="#dashboard">ğŸ“Š Dashboard</a>
      <a href="#products">ğŸ›ï¸ Manage Products</a>
      <a href="#orders">ğŸ“¦ Orders</a>
      <a href="#customers">ğŸ‘¥ Customers</a>
      <a href="#categories">ğŸ—ƒï¸ Categories</a>
      <a href="#settings">âš™ï¸ Settings</a>
    </div>

    <div class="content">
      <h2 id="dashboard">ğŸ“Š Dashboard Overview</h2>
      <div class="row">
        <div class="col-md-4">
          <div class="card card-body text-center">
            <h4>Total Sales</h4>
            <p id="total-sales">â‚¹0</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card card-body text-center">
            <h4>Total Orders</h4>
            <p id="total-orders">0</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card card-body text-center">
            <h4>Top Product</h4>
            <p id="top-product">N/A</p>
          </div>
        </div>
      </div>

      <h2 id="products">ğŸ›ï¸ Product Management</h2>
      <form class="mb-4" id="product-form">
        <input class="form-control mb-2" type="text" placeholder="Product Name">
        <input class="form-control mb-2" type="text" placeholder="Price">
        <textarea class="form-control mb-2" placeholder="Description"></textarea>
        <input class="form-control mb-2" type="text" placeholder="Image URL">
        <select class="form-control mb-2">
          <option>Select Category</option>
          <option>Home & Kitchen</option>
          <option>Men</option>
          <option>Beauty & Health</option>
          <option>Electronics</option>
        </select>
        <button class="btn btn-success">Add Product</button>
      </form>

      <h2 id="orders">ğŸ“¦ Order Management</h2>
      <ul id="order-list" class="list-group"></ul>

      <h2 id="customers">ğŸ‘¥ Customer Management</h2>
      <p>Coming soon.</p>

      <h2 id="categories">ğŸ—ƒï¸ Category Management</h2>
      <form class="mb-4">
        <input class="form-control mb-2" type="text" placeholder="New Category Name">
        <button class="btn btn-primary">Add Category</button>
      </form>

      <h2 id="settings">âš™ï¸ Store Settings</h2>
      <form>
        <input class="form-control mb-2" type="text" placeholder="Store Name" value="JB Essential">
        <input class="form-control mb-2" type="text" placeholder="Support Email" value="contact.jbessential@gmail.com">
        <button class="btn btn-secondary">Update Settings</button>
      </form>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBlnTXaiylzMn67Z4tKc46LwDLArlEBcnE",
      authDomain: "jbessential-def67.firebaseapp.com",
      projectId: "jbessential-def67",
      storageBucket: "jbessential-def67.appspot.com",
      messagingSenderId: "380875888035",
      appId: "1:380875888035:web:cf9b2e99b9a0b727533616",
      databaseURL: "https://jbessential-def67-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function loginAdmin() {
      const username = document.getElementById('admin-username').value;
      const password = document.getElementById('admin-password').value;
      const error = document.getElementById('login-error');

      if (username === 'adminpanel786' && password === 'jbessentialadminpanel786') {
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'block';
        fetchOrders();
      } else {
        error.classList.remove('d-none');
      }
    }

    function fetchOrders() {
      db.ref("orders").on("value", snapshot => {
        const orders = snapshot.val();
        const list = document.getElementById("order-list");
        list.innerHTML = '';
        let count = 0;
        let totalSales = 0;
        let productCount = {};

        for (const id in orders) {
          const order = orders[id];
          const item = document.createElement("li");
          item.className = "list-group-item";
          item.innerHTML = `<strong>${order.name || 'No Name'}</strong><br>Total: â‚¹${order.total || 0}<br>Items: ${order.items.map(i => i.name + ' x' + i.qty).join(', ')}`;
          list.appendChild(item);
          count++;

          totalSales += parseFloat(order.total || 0);

          (order.items || []).forEach(i => {
            if (!productCount[i.name]) productCount[i.name] = 0;
            productCount[i.name] += parseInt(i.qty || 0);
          });
        }

        document.getElementById("total-orders").innerText = count;
        document.getElementById("total-sales").innerText = 'â‚¹' + totalSales.toFixed(2);

        let topProduct = "N/A", maxQty = 0;
        for (const name in productCount) {
          if (productCount[name] > maxQty) {
            maxQty = productCount[name];
            topProduct = name;
          }
        }
        document.getElementById("top-product").innerText = topProduct;
      });
    }

    function addProduct(event) {
      event.preventDefault();

      const name = document.querySelector('#products input[placeholder="Product Name"]').value.trim();
      const price = document.querySelector('#products input[placeholder="Price"]').value.trim();
      const desc = document.querySelector('#products textarea').value.trim();
      const image = document.querySelector('#products input[placeholder="Image URL"]').value.trim();
      const category = document.querySelector('#products select').value;

      if (!name || !price || !image || category === "Select Category") {
        alert("âš ï¸ Please fill all product fields correctly.");
        return;
      }

      const newProduct = {
        name,
        price: parseFloat(price),
        description: desc,
        image,
        category
      };

      db.ref("products").push(newProduct).then(() => {
        alert("âœ… Product uploaded successfully!");
        document.querySelector('#product-form').reset();
      }).catch(error => {
        console.error(error);
        alert("âŒ Failed to upload product.");
      });
    }

    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('login-button').addEventListener('click', loginAdmin);
      document.querySelector('#product-form').addEventListener('submit', addProduct);
    });
  </script>

</body>
</html>
